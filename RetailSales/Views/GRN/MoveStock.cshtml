@model RetailSales.Models.GRN
@{
    ViewData["Title"] = "GRN";
}
<style>
    .newwidth {
        width: 120px;
    }

    .text-right {
        text-align: right;
    }

</style>
<div style="height:25px;"></div>
<div class="row wrapper border-bottom page-heading">
    <div class="col-lg-12">

        <ol class="breadcrumb">
            <li class="active"> <strong>Move Stock</strong> </li>
        </ol>
    </div>
</div>

<div class="wrapper-content ">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="widgets-container">
                    @using (Html.BeginForm("MoveStock", "GRN", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        <form>
                            <br />
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label for="inputName3" class="col-sm-5 control-label"><strong>GRN No :</strong><label class="mandatory"></label></label>

                                        @Html.HiddenFor(C => C.ID)
                                        @Html.DisplayFor(C => C.GRNNo)

                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label for="inputName3" class="col-sm-4 control-label"><strong>GRN Date :</strong><label class="mandatory"></label></label>

                                        @Html.DisplayFor(C => C.GRNDate)

                                    </div>
                                </div>

                            </div>
                            <div style="height:20px;"></div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label for="inputName3" class="col-sm-5 control-label"><strong>Supplier Name :</strong><label class="mandatory"></label></label>

                                        @Html.DisplayFor(C => C.SuppName)

                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">

                                        <label for="inputName3" class="col-sm-4 control-label"><strong>Supplier Address :</strong><label class="mandatory"></label></label>

                                        @Html.DisplayFor(C => C.SuppAdd)

                                    </div>
                                </div>
                            </div>
                            <div style="height:20px;"></div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">

                                        <label for="inputName3" class="col-sm-5 control-label"><strong>State :</strong><label class="mandatory"></label></label>

                                        @Html.DisplayFor(C => C.State)

                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">

                                        <label for="inputName3" class="col-sm-4 control-label"><strong>City :</strong><label class="mandatory"></label></label>

                                        @Html.DisplayFor(C => C.City)

                                    </div>
                                </div>
                            </div>
                            <div style="height:20px;"></div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label for="inputName3" class="col-sm-5 control-label"><strong>Supplier Ref No :</strong><label class="mandatory"></label></label>

                                        @Html.DisplayFor(C => C.RefNo)


                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label for="inputName3" class="col-sm-4 control-label"><strong>Ref Date :</strong><label class="mandatory"></label></label>

                                        @Html.DisplayFor(C => C.RefDate)

                                    </div>
                                </div>
                            </div>


                            <div style="height:30px;"></div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="col-md-12" style="overflow-x:scroll; min-width:300px; min-height:100px;">
                                        @* table id="example7" class="display nowrap table  responsive nowrap table-bordered" *@
                                        <table class="table table-striped table-hover" id="dataTable">
                                            <thead>
                                                <tr>

                                                    <th>Item</th>
                                                    <th>Product</th>
                                                    <th>Variant </th>
                                                    <th> HSN </th>
                                                    <th>Tax</th>
                                                    <th> Unit </th>
                                                    <th> Ordered </th>
                                                    <th> Received </th>
                                                    <th>Shop Qty</th>
                                                    <th>BIN No</th>
                                                    <th>Godown Qty</th>
                                                    <th>BIN No</th>
                                                    
                                                </tr>
                                            </thead>

                                            <tbody>
                                                @{
                                                    int i = 0;

                                                    foreach (var item in Model.GRNLst.ToList())
                                                    {

                                                        <tr id="trBook@(i)" class="chkitemlst" style="height: 30px;border-bottom: 1px dashed #ddd;">
                                                            <td>@Html.DisplayFor(o => o.GRNLst[i].Item)
                                                                @Html.HiddenFor(o => o.GRNLst[i].Itemid)
                                                            </td>
                                                            <td>@Html.DisplayFor(o => o.GRNLst[i].Product)
                                                                @Html.HiddenFor(o => o.GRNLst[i].Productid)
                                                            </td>
                                                            <td>@Html.DisplayFor(o => o.GRNLst[i].Varient)
                                                                @Html.HiddenFor(o => o.GRNLst[i].Varientid)
                                                            </td>
                                                            <td>@Html.DisplayFor(o => o.GRNLst[i].Hsn)</td>
                                                            <td>@Html.DisplayFor(o => o.GRNLst[i].Tariff)</td>
                                                            <td>@Html.DisplayFor(o => o.GRNLst[i].UOM)</td>
                                                            <td>
                                                                @Html.DisplayFor(o => o.GRNLst[i].Ordered)
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(o => o.GRNLst[i].Recived)
                                                                @Html.HiddenFor(o => o.GRNLst[i].Recived, new { @id = "txtReceived" + i })
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(o => o.GRNLst[i].ShopQty, new { @id = "txtShopQty" + i, @class = "form-control", style = "width: 80px;", type = "number", onkeydown = "return isNumeric2(event.keyCode,this.value)" ,onkeyup="changeQty(this.value," + i + ")"  })
                                                            </td>
                                                            <td>
                                                                @Html.DropDownListFor(o => o.GRNLst[i].ShopBin, Model.GRNLst[i].ShopBinlist, "---Please Select---", new { @class = "form-control _select newcss", @id = "ddlShopBin" + i, style = "width: 120px;" })
                                                            </td>
                                                            <td>
                                                                @Html.TextBoxFor(o => o.GRNLst[i].GodownQty, new { @id = "txtGodownQty" + i, @class = "form-control", style = "width: 80px;", type = "number", onkeydown = "return isNumeric2(event.keyCode,this.value)", onkeyup = "changeQty(this.value," + i + ")" })
                                                            </td>
                                                            <td>
                                                                @Html.DropDownListFor(o => o.GRNLst[i].GodownBin, Model.GRNLst[i].GodownBinlist, "---Please Select---", new { @class = "form-control _select newcss", @id = "ddlGodownBin" + i, style = "width: 120px;" })
                                                                @Html.HiddenFor(o => o.GRNLst[i].Isvalid, new { @id = "Isvalid" + i })
                                                            </td>

                                                        </tr>
                                                        //i = i + 1;
                                                        i++;
                                                    }
                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div style="height:30px;"></div>
                            <div class="col-lg-8"></div>
                            <button type="submit" class="btn btn-success" id="btnSave">Submit</button>
                            <button class="btn btn-danger" type="button" causesvalidation="false" onclick="location.href='@Url.Action("ListGRN", "GRN")'">Cancel</button>


                        </form>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('._select').select2();
    });
    function PopulateDropDown(dropDownId, list) {
        //alert(list);
        $(dropDownId).empty().append('<option selected="selected" value="0">--Please select--</option>');
        if (list != null && list.length > 0) {
            $(dropDownId).removeAttr("disabled");
            $.each(list, function () {
                $(dropDownId).append($("<option></option>").val(this['value']).html(this['text']));
            });
        }
        $(dropDownId).trigger("liszt:updated");
    }
    function changeQty(_this, i) {
         var ordqty =parseFloat(document.getElementById("txtReceived" + i).value) || 0;
         var shopqty =parseFloat(document.getElementById("txtShopQty" + i).value) || 0;
         var godownqty =parseFloat(document.getElementById("txtGodownQty" + i).value) || 0;
         
         var $shopInput = $("#txtShopQty" + i);
         var $godownInput = $("#txtGodownQty" + i);

             if((shopqty + godownqty) != ordqty)
             {
                 isValid = false;
                 $shopInput.css({ "border": "1px solid red", "background": "#FFCECE" });
                 $godownInput.css({ "border": "1px solid red", "background": "#FFCECE" });
                 //alert("Missing Qty!");
                 return false;
             }
             else {
                    $shopInput.css({ "border": "", "background": "" });
                    $godownInput.css({ "border": "", "background": "" });
             }
           
     }
     $(document).ready(function () {
        $('#btnSave').click(function (e) {
            var isValid = true;

            var j = 0;
            $('tr.chkitemlst').each(function () {
                if ($(this).css('display') !== 'none') {

                    if ($(this).find('#txtShopQty' + j.toString()).val() == "") {
                        isValid = false;
                        $(this).find('#txtShopQty' + j.toString()).css({
                            "border": "1px solid red",
                            "background": "#FFCECE"
                        });

                        alert("Please Enter Shop Qty");
                        $(this).find('#txtShopQty' + j.toString()).focus();
                        return false;

                    }
                    else {
                        $(this).find('#txtShopQty' + j.toString()).css({
                            "border": "",
                            "background": ""
                        });
                    }

                    if ($(this).find('#ddlShopBin' + j.toString()).val() != "" || $(this).find('#ddlShopBin' + j.toString()).val() != "0") {

                        if ($(this).find('#ddlShopBin' + j.toString()).val() == "" || $(this).find('#ddlShopBin' + j.toString()).val() == 0) {
                            isValid = false;
                            $(this).find('#ddlShopBin' + j.toString()).css({
                                "border": "1px solid red",
                                "background": "#FFCECE"
                            });
                            alert("Please Select BIN No");
                            $(this).find('#ddlShopBin' + j.toString()).focus();
                            return false;
                        }
                        else {
                            $(this).find('#ddlShopBin' + j.toString()).css({
                                "border": "",
                                "background": ""
                            });
                        }
                    }
                    if ($(this).find('#txtGodownQty' + j.toString()).val() == "") {
                        isValid = false;
                        $(this).find('#txtGodownQty' + j.toString()).css({
                            "border": "1px solid red",
                            "background": "#FFCECE"
                        });

                        alert("Please Enter Godown Qty");
                        $(this).find('#txtGodownQty' + j.toString()).focus();
                        return false;

                    }
                    else {
                        $(this).find('#txtGodownQty' + j.toString()).css({
                            "border": "",
                            "background": ""
                        });
                    }
                    if ($(this).find('#ddlGodownBin' + j.toString()).val() != "" || $(this).find('#ddlGodownBin' + j.toString()).val() != "0") {

                        if ($(this).find('#ddlGodownBin' + j.toString()).val() == "" || $(this).find('#ddlGodownBin' + j.toString()).val() == 0) {
                            isValid = false;
                            $(this).find('#ddlGodownBin' + j.toString()).css({
                                "border": "1px solid red",
                                "background": "#FFCECE"
                            });
                            alert("Please Select BIN No");
                            $(this).find('#ddlGodownBin' + j.toString()).focus();
                            return false;
                        }
                        else {
                            $(this).find('#ddlGodownBin' + j.toString()).css({
                                "border": "",
                                "background": ""
                            });
                        }
                    }
                    var ordqty = parseFloat(document.getElementById("txtReceived" + j).value) || 0;
                    var shopqty = parseFloat(document.getElementById("txtShopQty" + j).value) || 0;
                    var godownqty = parseFloat(document.getElementById("txtGodownQty" + j).value) || 0;
                    var $shopInput = $("#txtShopQty" + j);
                    var $godownInput = $("#txtGodownQty" + j);
                    if ((shopqty + godownqty) != ordqty) {
                        isValid = false;
                        $shopInput.css({ "border": "1px solid red", "background": "#FFCECE" });
                        $godownInput.css({ "border": "1px solid red", "background": "#FFCECE" });
                        alert("Recived Qty and Inventory Qty Not Match . Please check");
                        return false;
                    }
                    else {
                        $shopInput.css({ "border": "", "background": "" });
                        $godownInput.css({ "border": "", "background": "" });
                    }
                    
                }
                j += 1;
            });


            if (isValid == false)
                e.preventDefault();
        });

    });
</script>



